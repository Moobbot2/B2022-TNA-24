<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .form-check-input+.form-label {
            margin-bottom: 0;
            margin-left: 10px;
        }

        .form-check-input {
            margin-top: 0;
            width: 20px;
            height: 20px;
        }

        .border-custom-4 {
            border: 4px solid;
            border-radius: 15px;
        }
    </style>
</head>

<body class="bg-light" style="
      background: url('./bg-0.jpg') no-repeat center center/cover;
      width: 100vw;
      height: 100vh;
      min-width: 300px !important;
    ">
    <div class="position-fixed"><button type="button" class="btn btn-danger js-update-model">Cập nhật mô hình</button>
    </div>
    <div class="container h-100 d-flex justify-content-center align-items-center">
        <main>
            <div class="card text-dark border-custom-4" style="background-color: #c5f5ffb5">
                <div class="card-header position-relative">
                    <div class="logo-who position-absolute" style="width: 50px">
                        <img src="./who-logo-png.png" alt="" class="img-fluid" />
                    </div>
                    <h1 class="card-title text-center">
                        Biểu mẫu dự đoán Ung thư đại trực tràng
                    </h1>
                </div>
                <form action class="js_form_submit">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="đau bụng" />
                                        <label for="" class="form-label">Đau bụng</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom" value="nôn" />
                                        <label for="" class="form-label">Nôn</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="chán ăn" />
                                        <label for="" class="form-label">Chán ăn</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="táo bón" />
                                        <label for="" class="form-label">Táo bón</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="sút cân" />
                                        <label for="" class="form-label">Sút cân</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="tiêu chảy" />
                                        <label for="" class="form-label">Tiêu chảy</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="phân có máu" />
                                        <label for="" class="form-label">Phân có máu</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="da niêm mạc vàng" />
                                        <label for="" class="form-label">Da niêm mạc vàng</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom" value="da sạm" />
                                        <label for="" class="form-label">Da sạm</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="hạch ngoại biên" />
                                        <label for="" class="form-label">Hạch ngoại biên</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="hạch thượng đòn" />
                                        <label for="" class="form-label">Hạch thượng đòn</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="bụng chướng" />
                                        <label for="" class="form-label">Bụng chướng</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="phản ứng thành bụng" />
                                        <label for="" class="form-label">Phản ứng thành bụng</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="cảm ứng phúc mạc" />
                                        <label for="" class="form-label">Cảm ứng phúc mạc</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="dấu hiệu rắn bò" />
                                        <label for="" class="form-label">Dấu hiệu rắn bò</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="quai ruột nổi" />
                                        <label for="" class="form-label">Quai ruột nổi</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="sờ thấy khối u" />
                                        <label for="" class="form-label">Sờ thấy khối u</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="thăm trực tràng có khối u" />
                                        <label for="" class="form-label">Thăm trực tràng có khối u</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="tiền sử ung thư" />
                                        <label for="" class="form-label">Tiền sử ung thư</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="chụp CT ổ bụng có khối u" />
                                        <label for="" class="form-label">Chụp CT ổ bụng có khối u</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="form-group">
                                    <div class="form-check d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input" name="symptom"
                                            value="nội soi đại tràng có khối u" />
                                        <label for="" class="form-label">Nội soi đại tràng có khối u</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        <div class="input-group mb-2">
                            <input type="file" class="form-control js-file" id="file-upload" placeholder="Hồ sơ bệnh án"
                                accept=".jpg, .png, .pdf" />
                        </div>
                        <div class="js-wrap">
                            <input type="hidden" name="ket_qua" value="0">
                            <button type="submit" class="btn btn-success">Dự đoán</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="card text-dark border-custom-4 mt-4" style="width: 100%; background-color: #89ffc8">
                <div class="card-header">
                    <h5 class="card-title">Kết quả dự đoán</h5>
                </div>
                <div class="card-body" style="height: 80px">
                    <h3 class="card-text js_check_crc text-center"></h3>
                </div>
            </div>
        </main>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    var btn_udpate_data = '<button type="button" class="btn btn-warning js-update-data">Trường hợp đặc trưng</button>';

    function predict(data) {
        $.ajax({
            type: "POST",
            url: "http://127.0.0.1:5000/api_predict",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (response) {
                // Display the predicted result
                $(".js_check_crc").text(response.predictions);
                $(".js-wrap").append(btn_udpate_data);
            },
            error: function (xrh, error) {
                console.log("Error:", xrh);
                alert(xrh.responseJSON.error);
            },
        });
    }

    function insert_db(data) {
        // Ask the user if they want to proceed
        if (confirm('Các triệu chứng này là trường hợp đặc trưng?')) {
            // If the user confirms, make the AJAX call
            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:5000/api_save_data",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data),
                success: function (response) {
                    // Display the predicted result
                    $(".js_check_crc").text(response.predictions);
                    if (response.error) {
                        console.log(response.error);
                    }
                },
                error: function (xrh, error) {
                    console.log("Error:", xrh);
                    alert(xrh.responseJSON.error);
                },
            });
        } else {
            // If the user cancels, do nothing
            console.log('User canceled the operation.');
        }
    }

    // Attach change event to checkboxes
    $('input[name="symptom"]').change(function () {
        $(".js_check_crc").text("");// Clear text when checkboxes change
        $(".js-update-data").remove();
    });

    $('.js_form_submit').submit(function (e) {
        e.preventDefault();
        // $('.js_check_crc').text('');
        // Get selected checkbox values
        var selectedSymptoms = [];
        $('input[name="symptom"]:checked').each(function () {
            selectedSymptoms.push($(this).val());
        });

        // Check if at least one symptom is selected
        if (selectedSymptoms.length === 0) {
            alert('Please select at least one symptom.');
            return;
        }

        // Log the selected symptoms to the console
        console.log(selectedSymptoms);
        console.log('Call predict');
        // Make a prediction request
        predict({ features: selectedSymptoms });
    });

    $(document).on("click", ".js-update-data", function () {
        $('.js_check_crc').text('');
        // Get selected checkbox values
        var selectedSymptoms = [];
        $('input[name="symptom"]:checked').each(function () {
            selectedSymptoms.push($(this).val());
        });
        // Check if at least one symptom is selected
        if (selectedSymptoms.length === 0) {
            alert("Please select at least one symptom.");
            return;
        }
        selectedSymptoms.push($('input[name="ket_qua"]').val());

        // Log the selected symptoms to the console
        console.log(selectedSymptoms);
        console.log("Call insert_db");
        // Make a prediction request
        insert_db({ features: selectedSymptoms });
        $(".js-update-data").remove();
    });

    $(".js-update-model").click(function (e) {
        e.preventDefault();
        if (confirm('Cập nhật model?')) {
            // If the user confirms, make the AJAX call
            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:5000/api_update_module",
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    // Display the predicted result
                    $(".js_check_crc").text(response.message);
                    alert(response.message)
                },
                error: function (xrh, error) {
                    console.log("Error:", xrh);
                    alert(xrh.responseJSON.error);
                },
            });
        } else {
            // If the user cancels, do nothing
            console.log('User canceled the operation.');
        }
    });

</script>

</html>